<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{display_name}</title>
        <script>
            // Server-provided config - must be defined before loading chat.js
            window.config = {js_config};
        </script>
        <script src="/static/chat.js" defer></script>
        <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
            background-color: #121b22; 
            color: #e6e6e6; 
            margin: 0; 
            padding: 0; 
        }
        .header { 
            background-color: #1f2c34; 
            padding: 12px 16px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: sticky; 
            top: 0; 
            z-index: 100; 
        }
        .chat-container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 12px; 
            /* Make the chat area scrollable so JS can detect scroll events on it */
            height: calc(100vh - 68px); /* leave room for the header */
            overflow-y: auto;
        }
        .message { 
            display: flex; 
            margin-bottom: 8px; 
        }
        .message.received { flex-direction: row; }
        .message.sent { flex-direction: row-reverse; }
        .bubble { 
            padding: 10px 12px; 
            border-radius: 7.5px; 
            max-width: 65%; 
            word-wrap: break-word; 
            font-size: 16px; 
        }
        .received .bubble { 
            background-color: #202c33; 
            color: #e6e6e6; 
            border-top-left-radius: 0; 
        }
        .sent .bubble { 
            background-color: #005c4b; 
            color: white; 
            border-top-right-radius: 0; 
        }
        .sender { 
            font-size: 13px; 
            font-weight: bold; 
            color: #8c99a2; 
            margin-bottom: 3px; 
        }
        .timestamp { 
            font-size: 11px; 
            color: #78828a; 
            text-align: right; 
            margin-top: 4px; 
        }
        .media { 
            max-width: 100%; 
            border-radius: 8px; 
            display: block; 
            margin-top: 4px; 
        }
        .system { 
            text-align: center; 
            color: #8c99a2; 
            font-style: italic; 
            margin: 12px 0; 
            background: rgba(0,0,0,0.2); 
            padding: 6px 12px; 
            border-radius: 8px; 
        }
        .back-home-btn { 
            background-color: #34414a; 
            color: #fff; 
            border: none; 
            padding: 6px 14px; 
            border-radius: 4px; 
            font-size: 15px; 
            cursor: pointer; 
            margin-right: 12px; 
        }
        #search-box, #my-name, #jump-box, #batch-size { 
            padding: 4px; 
            background-color: #202c33; 
            border: 1px solid #34414a; 
            color: white; 
            border-radius: 4px; 
            font-size: 13px; 
        }
        .loading { 
            text-align: center; 
            padding: 20px; 
            color: #78828a; 
        }
        .pagination { 
            text-align: center; 
            padding: 12px; 
            background-color: #1f2c34; 
        }
        .pagination button { 
            background-color: #005c4b; 
            color: white; 
            border: none; 
            padding: 6px 12px; 
            margin: 0 4px; 
            border-radius: 4px; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-home-btn" onclick="window.location.href='/'">‚Üê Home</button>
        <strong>{display_name}</strong>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <label for="my-name" style="font-size:13px;color:#8c99a2;">Me:</label>
            <select id="my-name"><option value="">Select your name...</option></select>
            <input type="text" id="search-box" placeholder="Search messages..." value="{search_query}">
            <input type="text" id="jump-box" placeholder="Jump to # or text" style="width:180px">
            <button onclick="handleJump()" style="background-color:#00a884;border:none;color:#04211e;padding:6px 8px;border-radius:4px;cursor:pointer;font-weight:600">Go</button>
            <label for="batch-size" style="font-size:13px;color:#8c99a2;">Batch size:</label>
            <input type="number" id="batch-size" min="1" max="500" value="{batch_size}" style="width:70px">
        </div>
    </div>
    <div class="chat-container" id="chat-container">
        <div class="loading">Loading messages...</div>
    </div>
    <div class="pagination" id="pagination"></div>

    <!-- chat.js loaded in <head> reads window.config; UI logic lives in static/chat.js -->
</body>
</html>